{
  "entities": {
    "UserProfile": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "User Profile",
      "type": "object",
      "description": "Represents a user's public profile and contribution status.",
      "properties": {
        "uid": {
          "type": "string",
          "description": "The user's unique ID from Firebase Auth."
        },
        "displayName": {
          "type": "string",
          "description": "The user's public display name."
        },
        "email": {
          "type": "string",
          "format": "email",
          "description": "The user's email address."
        },
        "role": {
          "type": "string",
          "description": "User role, e.g., 'contributor', 'verifier', 'admin'.",
          "enum": ["contributor", "verifier", "admin", "reader"]
        },
        "lastActivity": {
          "type": "string",
          "format": "date-time",
          "description": "Timestamp of the user's last activity."
        }
      },
      "required": ["uid", "email", "role"]
    },
    "CodeArticle": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Code Article",
      "type": "object",
      "description": "A single record from a building code or regulation, part of the Atlas collection.",
      "properties": {
        "slug": {
          "type": "string",
          "description": "Unique slug for the document, e.g., ng_building_code_2024."
        },
        "title": {
          "type": "string",
          "description": "Human-readable title of the code or regulation."
        },
        "country": {
          "type": "string",
          "description": "Controlled ISO code for the country."
        },
        "region": {
          "type": "string",
          "description": "Subnational region, e.g., Lagos State."
        },
        "jurisdiction": {
          "type": "string",
          "description": "Level of government: national, state, or municipal."
        },
        "category": {
          "type": "array",
          "items": { "type": "string" },
          "description": "Array of categories like 'structural', 'fire', 'accessibility'."
        },
        "summary": {
          "type": "string",
          "description": "A 200â€“400 character summary of the document."
        },
        "full_text_url": {
          "type": "string",
          "format": "uri",
          "description": "Canonical source link (PDF or government website)."
        },
        "file_refs": {
          "type": "array",
          "items": {
            "type": "object",
            "properties": {
              "type": { "type": "string" },
              "storage_path": { "type": "string" },
              "caption": { "type": "string" }
            }
          },
          "description": "References to stored files, like PDFs."
        },
        "effective_date": {
          "type": "string",
          "format": "date",
          "description": "The date the code becomes effective."
        },
        "last_updated": {
          "type": "string",
          "format": "date",
          "description": "The date the code was last updated."
        },
        "related_terms": {
          "type": "array",
          "items": { "type": "string" },
          "description": "Slugs of related terms in the Lexicon."
        },
        "related_precedents": {
          "type": "array",
          "items": { "type": "string" },
          "description": "Document IDs of related precedents in the Archive."
        },
        "tags": {
          "type": "array",
          "items": { "type": "string" },
          "description": "General tags for filtering."
        },
        "climate_zones": {
          "type": "array",
          "items": { "type": "string" },
          "description": "Applicable climate zones, e.g., 'tropical_wet'."
        },
        "metadata": {
          "type": "object",
          "properties": {
            "source_organization": { "type": "string" },
            "source_contact": { "type": "string" },
            "license": {
              "type": "string",
              "enum": ["public_domain", "cc_by_4.0", "proprietary_contact"]
            }
          }
        },
        "provenance": {
          "type": "object",
          "properties": {
            "created_by": { "type": "string" },
            "created_at": { "type": "string", "format": "date-time" },
            "verified_by": { "type": "string" },
            "verified_at": { "type": "string", "format": "date-time" },
            "verification_status": {
              "type": "string",
              "enum": ["draft", "submitted", "verified", "rejected"]
            }
          }
        },
        "search_terms": {
          "type": "array",
          "items": { "type": "string" },
          "description": "Precomputed synonyms for search ranking."
        },
        "geo": {
          "type": "object",
          "properties": {
            "type": { "enum": ["Polygon", "Point"] },
            "coordinates": { "type": "array" }
          },
          "description": "GeoJSON object for localized bylaws."
        },
        "score": {
          "type": "number",
          "minimum": 0,
          "maximum": 100,
          "description": "Internal trust or completeness score (0-100)."
        }
      },
      "required": ["slug", "title", "country", "category", "summary"]
    },
    "Precedent": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Precedent",
      "type": "object",
      "description": "Represents an architectural precedent stored in the CODEA library's archive.",
      "properties": {
        "slug": {
          "type": "string",
          "description": "Unique slug for the precedent, e.g., yoruba_courtyard_house_1978."
        },
        "title": {
          "type": "string",
          "description": "The title of the architectural precedent."
        },
        "location": {
          "type": "object",
          "properties": {
            "country_iso": { "type": "string" },
            "region": { "type": "string" },
            "city": { "type": "string" },
            "lat": { "type": "number" },
            "lng": { "type": "number" }
          },
          "required": ["country_iso"],
          "description": "Geographic location of the precedent."
        },
        "year_completed": {
          "type": "number",
          "description": "The year the precedent was completed."
        },
        "authors": {
          "type": "array",
          "items": {
            "type": "object",
            "properties": {
              "name": { "type": "string" },
              "affiliation": { "type": "string" },
              "contact": { "type": "string" }
            }
          },
          "description": "Architects, designers, or firms responsible for the work."
        },
        "typology": {
          "type": "array",
          "items": { "type": "string" },
          "description": "Controlled vocabulary for precedent type, e.g., 'residential', 'courtyard_house'."
        },
        "materials": {
          "type": "array",
          "items": { "type": "string" },
          "description": "Controlled vocabulary for primary materials, e.g., 'laterite', 'timber'."
        },
        "climate_zones": {
          "type": "array",
          "items": { "type": "string" },
          "description": "Applicable climate zones."
        },
        "summary": {
          "type": "string",
          "description": "A detailed summary of the precedent."
        },
        "images": {
          "type": "array",
          "items": {
            "type": "object",
            "properties": {
              "storage_path": { "type": "string" },
              "caption": { "type": "string" },
              "credit": { "type": "string" }
            }
          },
          "description": "References to images in cloud storage."
        },
        "plans": {
          "type": "array",
          "items": {
            "type": "object",
            "properties": {
              "storage_path": { "type": "string" },
              "type": { "enum": ["plan", "section", "elevation"] },
              "caption": { "type": "string" }
            }
          },
          "description": "References to architectural drawings."
        },
        "related_codes": {
          "type": "array",
          "items": { "type": "string" },
          "description": "Slugs of related articles in the Atlas."
        },
        "related_terms": {
          "type": "array",
          "items": { "type": "string" },
          "description": "Slugs of related terms in the Lexicon."
        },
        "tags": {
          "type": "array",
          "items": { "type": "string" },
          "description": "General tags for filtering."
        },
        "license": {
          "type": "string",
          "description": "Data license, e.g., 'cc_by_4.0'."
        },
        "provenance": {
          "type": "object",
          "properties": {
            "submitted_by": { "type": "string" },
            "submitted_at": { "type": "string", "format": "date-time" },
            "verified_by": { "type": "string" },
            "verified_at": { "type": "string", "format": "date-time" },
            "verification_status": {
              "type": "string",
              "enum": ["draft", "submitted", "verified", "rejected"]
            }
          }
        },
        "attachments": {
          "type": "array",
          "items": { "type": "object" },
          "description": "References to other documents like field notes or interviews."
        },
        "access_level": {
          "type": "string",
          "enum": ["public", "restricted", "private"],
          "description": "Controls visibility of the record."
        }
      },
      "required": ["slug", "title", "location", "typology", "summary"]
    },
    "LexiconTerm": {
      "$schema.json": "http://json-schema.org/draft-07/schema#",
      "title": "Lexicon Term",
      "type": "object",
      "description": "A single term in the multilingual glossary.",
      "properties": {
        "term": {
          "type": "string",
          "description": "The primary term or keyword."
        },
        "definition": {
          "type": "string",
          "description": "The definition of the term."
        },
        "category": {
          "type": "string",
          "enum": ["Cultural", "Environmental", "Spatial", "Material"],
          "description": "The primary category of the term."
        },
        "relatedTerms": {
          "type": "array",
          "items": { "type": "string" },
          "description": "IDs of related terms in the Lexicon."
        },
        "relatedCodes": {
          "type": "array",
          "items": { "type": "string" },
          "description": "IDs of related articles in the Atlas."
        }
      },
      "required": ["term", "definition", "category"]
    }
  },
  "auth": {
    "providers": [
      "password",
      "anonymous"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/archive/{archiveId}",
        "definition": {
          "entityName": "Precedent",
          "schema": {
            "$ref": "#/backend/entities/Precedent"
          },
          "description": "Stores architectural precedents that are publicly accessible."
        }
      },
      {
        "path": "/atlas/{articleId}",
        "definition": {
          "entityName": "CodeArticle",
          "schema": {
            "$ref": "#/backend/entities/CodeArticle"
          },
          "description": "Stores individual building code and regulation articles."
        }
      },
      {
        "path": "/lexicon/{termId}",
        "definition": {
          "entityName": "LexiconTerm",
          "schema": {
            "$ref": "#/backend/entities/LexiconTerm"
          },
          "description": "Stores cultural and environmental architectural terms."
        }
      },
      {
        "path": "/users/{userId}",
        "definition": {
          "entityName": "UserProfile",
          "schema": {
            "$ref": "#/backend/entities/UserProfile"
          },
          "description": "Stores public user profile information."
        }
      }
    ]
  }
}
